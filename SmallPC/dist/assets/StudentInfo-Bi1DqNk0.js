import{l as e,E as t,h as a,d as s,i as l,c as i,a as r,e as o,f as n,w as d,j as h,o as g,g as p,t as c}from"./index-Snwcd9S9.js";import{_ as u}from"./_plugin-vue_export-helper-BCo6x5W8.js";const m={class:"audit"},f={class:"message"},b=["src"],y=["href"],C={class:"fy"};const v=u({data:()=>({loading:!1,total:0,fileList:[],search:{pageCount:1,pageSize:10},msg:{imgUrl:""},tableList:[]}),created(){this.toSearch()},methods:{toSearch(){var a;this.loading=!0,(a=this.search,e({url:"/loopimg/list",method:"post",data:a})).then((e=>{200==e.code?(this.tableList=e.data.records.filter((e=>"1"!==e.isDelete)),this.total=e.data.total):(this.tableList=[],this.total=0),this.loading=!1})).catch((()=>{t({type:"error",message:"获取轮播图失败"}),this.loading=!1}))},send(){if(0===this.fileList.length)return void t({type:"error",message:"请上传轮播图图片"});if(!this.msg.imgUrl)return void t({type:"error",message:"请输入图片跳转链接"});this.loading=!0;const a=new FormData;var s;a.append("value","1"),a.append("loopImg",this.fileList[0].raw),a.append("imgUrl",this.msg.imgUrl),(s=a,e({url:"/loopimg/upload",method:"post",data:s,headers:{"Content-Type":"multipart/form-data"}})).then((e=>{200==e.code?(t({type:"success",message:"发送成功！"}),this.msg={imgUrl:""},this.fileList=[],this.toSearch()):t({type:"error",message:`发送失败：${e.message||"未知错误"}`}),this.loading=!1})).catch((e=>{var a,s;const l=(null==(s=null==(a=e.response)?void 0:a.data)?void 0:s.message)||"上传失败，可能是网络或服务器问题";t({type:"error",message:`轮播图上传失败: ${l}`}),this.loading=!1}))},handleDelete(s){this.loading=!0,a.confirm("将不再显示给用户","确定删除此轮播图？",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((()=>{var a;(a={id:s},e({url:"/loopimg/delete",method:"post",data:a})).then((e=>{200==e.code?(t({type:"success",message:"删除成功！"}),this.tableList=this.tableList.filter((e=>e.id!==s)),0===this.tableList.length&&this.search.pageCount>1&&(this.search.pageCount-=1),this.toSearch()):t({type:"error",message:"删除失败！"}),this.loading=!1})).catch((()=>{t({type:"error",message:"删除轮播图失败"}),this.loading=!1}))}))},handleUploadSuccess(e,a,s){t({type:"success",message:"图片上传成功"}),this.fileList=s},handleUploadError(e,a,s){t({type:"error",message:`图片上传失败: ${e.message||"未知错误"}`})},handleSizeChange(e){this.search.pageSize=e,this.toSearch()},handleCurrentChange(e){this.search.pageCount=e,this.toSearch()}}},[["render",function(e,t,a,u,v,S){const z=s("el-upload"),U=s("el-input"),L=s("el-button"),_=s("el-table-column"),x=s("el-table"),w=s("el-pagination"),k=l("loading");return g(),i("div",m,[t[5]||(t[5]=r("h3",{style:{"font-weight":"bold","text-align":"center","margin-bottom":"20px"}},"轮播图发布",-1)),r("div",f,[o(z,{class:"upload",action:"http://127.0.0.1:8080/api/loopimg/upload","list-type":"picture-card","on-success":S.handleUploadSuccess,"on-error":S.handleUploadError,limit:1,"file-list":v.fileList,"before-upload":e.beforeUpload},{default:n((()=>t[2]||(t[2]=[r("i",{class:"el-icon-plus"},null,-1)]))),_:1},8,["on-success","on-error","file-list","before-upload"]),o(U,{modelValue:v.msg.imgUrl,"onUpdate:modelValue":t[0]||(t[0]=e=>v.msg.imgUrl=e),placeholder:"请输入图片跳转链接",clearable:""},null,8,["modelValue"]),o(L,{type:"primary",plain:"",onClick:t[1]||(t[1]=e=>S.send())},{default:n((()=>t[3]||(t[3]=[p("发布")]))),_:1})]),d((g(),h(x,{data:v.tableList,border:"",style:{width:"100%"},height:"480","max-height":"480","empty-text":"暂无数据",size:"small"},{default:n((()=>[o(_,{fixed:"",prop:"imgUrl",label:"轮播图图片",width:"400",align:"center"},{default:n((e=>[r("img",{class:"image",src:e.row.image},null,8,b)])),_:1}),o(_,{prop:"url",label:"链接",width:"300",align:"center"},{default:n((e=>[r("a",{href:e.row.url,target:"_blank"},c(e.row.url),9,y)])),_:1}),o(_,{fixed:"right",label:"操作",align:"center"},{default:n((e=>[o(L,{size:"small",type:"danger",onClick:t=>S.handleDelete(e.row.id)},{default:n((()=>t[4]||(t[4]=[p(" 删除 ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[k,v.loading]]),r("div",C,[o(w,{size:"small",onSizeChange:S.handleSizeChange,onCurrentChange:S.handleCurrentChange,"current-page":v.search.pageCount,"page-size":v.search.pageSize,"page-sizes":[10,20,30,50],background:"",layout:"total, sizes, prev, pager, next, jumper",total:v.total},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])])}],["__scopeId","data-v-b0f79946"]]);export{v as default};
