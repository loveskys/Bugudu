import{n as e}from"./nullhead-BfHF6COK.js";import{_ as t}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{E as a,h as l,d as s,i as o,c as n,a as i,e as r,f as c,w as h,j as u,o as d,g as p,n as g,k as m,t as w}from"./index-Snwcd9S9.js";const C={class:"audit"},f={class:"search"},v=["src"],b={key:0,class:"authopt-wait"},y={key:1,class:"authopt-ok"},k={key:2,class:"authopt-no"},_={key:3,class:"authopt-no"},S={class:"fy"};const z=t({data:()=>({nullheadPng:e,loading:!1,activeButton:0,total:0,search:{pageCount:1,pageSize:10,schoolName:"",studentName:"",status:""},tableList:[]}),created(){this.toSearch(0)},methods:{reset(){this.search={pageCount:1,pageSize:10,schoolName:"",studentName:"",status:""},this.loading=!1,this.activeButton=0},toSearch(e){this.loading=!0,this.activeButton=e,this.search.status=e&&"0"!=e?e:"",this.$apis.authen.search(this.search).then((e=>{200==e.code?(this.tableList=e.data.records,this.total=e.data.total):(this.tableList=[],this.total=0),this.loading=!1}))},handleRoleChange(e){const t=e.userId,a=e.selectedCategory;this.updateUserRole(t,a)},updateUserRole(e,t){this.$apis.authen.updateRole({id:e,category:t}).then((e=>{200===e.code?a({type:"success",message:"角色更新成功！"}):a({type:"error",message:"角色更新失败！"})}))},handleAuth(e,t,a){2===t&&l.prompt("请输入Ta的年级（将显示在该用户的主页）：","通过该学生身份认证",{confirmButtonText:"通过",cancelButtonText:"取消"}).then((({value:l})=>{this.updateAuthStatus(e,t,l,a)})),3===t&&l.prompt("请输入原因：","驳回该学生身份认证",{confirmButtonText:"不通过",cancelButtonText:"取消"}).then((({value:l})=>{this.updateAuthStatus(e,t,l,a)}))},updateAuthStatus(e,t,l,s){this.loading=!0,this.$apis.authen.updateStatus({id:e,status:t,cont:l,userId:s}).then((e=>{200==e.code?(a({type:"success",message:"操作成功！"}),this.toSearch(this.activeButton)):a({type:"error",message:"修改失败！"}),this.loading=!1}))},handleSizeChange(e){this.search.pageSize=e,this.toSearch(this.activeButton)},handleCurrentChange(e){this.search.pageCount=e,this.toSearch(this.activeButton)}}},[["render",function(e,t,a,l,z,x){const B=s("el-input"),I=s("el-button"),N=s("el-button-group"),U=s("el-table-column"),V=s("el-image"),T=s("el-option"),A=s("el-select"),j=s("el-table"),R=s("el-pagination"),L=o("loading");return d(),n("div",C,[t[17]||(t[17]=i("h3",{style:{"font-weight":"bold"}},"学生认证审核",-1)),i("div",f,[r(B,{class:"item",modelValue:z.search.schoolName,"onUpdate:modelValue":t[0]||(t[0]=e=>z.search.schoolName=e)},{prepend:c((()=>t[7]||(t[7]=[p("学校名称")]))),_:1},8,["modelValue"]),r(B,{class:"item",modelValue:z.search.studentName,"onUpdate:modelValue":t[1]||(t[1]=e=>z.search.studentName=e)},{prepend:c((()=>t[8]||(t[8]=[p("学生姓名")]))),_:1},8,["modelValue"]),r(N,{class:"btn1"},{default:c((()=>[r(I,{type:"info",plain:"",onClick:x.reset},{default:c((()=>t[9]||(t[9]=[p("重置")]))),_:1},8,["onClick"]),r(I,{type:"primary",plain:"",onClick:t[2]||(t[2]=e=>x.toSearch())},{default:c((()=>t[10]||(t[10]=[p("搜索")]))),_:1})])),_:1}),r(N,{class:"btn2"},{default:c((()=>[r(I,{size:"small",class:g({active:0===z.activeButton}),type:"info",plain:"",onClick:t[3]||(t[3]=e=>x.toSearch(0))},{default:c((()=>t[11]||(t[11]=[p("全部")]))),_:1},8,["class"]),r(I,{size:"small",class:g({active:1===z.activeButton}),type:"info",plain:"",onClick:t[4]||(t[4]=e=>x.toSearch(1))},{default:c((()=>t[12]||(t[12]=[p("待审核")]))),_:1},8,["class"]),r(I,{size:"small",class:g({active:2===z.activeButton}),type:"info",plain:"",onClick:t[5]||(t[5]=e=>x.toSearch(2))},{default:c((()=>t[13]||(t[13]=[p("已通过")]))),_:1},8,["class"]),r(I,{size:"small",class:g({active:3===z.activeButton}),type:"info",plain:"",onClick:t[6]||(t[6]=e=>x.toSearch(3))},{default:c((()=>t[14]||(t[14]=[p("未通过")]))),_:1},8,["class"])])),_:1})]),h((d(),u(j,{data:z.tableList,border:"",style:{width:"100%"},height:"680","max-height":"680","empty-text":"暂无数据",size:"small"},{default:c((()=>[r(U,{fixed:"",prop:"headUrl",label:"头像",width:"60",align:"center"},{default:c((e=>[i("img",{class:"headUrl",src:e.row.headUrl?e.row.headUrl:z.nullheadPng},null,8,v)])),_:1}),r(U,{prop:"userName",label:"用户名",align:"center"}),r(U,{prop:"nickName",label:"昵称",width:"100",align:"center"}),r(U,{prop:"schoolName",label:"学校名称",align:"center"}),r(U,{prop:"authenType",label:"证件类型",width:"90",align:"center"}),r(U,{prop:"authenImg",label:"证件照片",width:"120",align:"center"},{default:c((e=>[r(V,{class:"authenImg","preview-teleported":"","hide-on-click-modal":"",src:e.row.authenImg,"preview-src-list":[e.row.authenImg],"initial-index":1,fit:"cover"},null,8,["src","preview-src-list"])])),_:1}),r(U,{prop:"grade",label:"年级",width:"100",align:"center"}),r(U,{prop:"studentNum",label:"学号",width:"100",align:"center"}),r(U,{prop:"createTime",label:"申请时间",width:"150",align:"center"}),r(U,{prop:"role",label:"角色",width:"150",align:"center"},{default:c((e=>[r(A,{modelValue:e.row.selectedCategory,"onUpdate:modelValue":t=>e.row.selectedCategory=t,placeholder:"选择角色",onChange:t=>x.handleRoleChange(e.row)},{default:c((()=>[r(T,{label:"普通用户",value:"0"}),r(T,{label:"开发者",value:"1"}),r(T,{label:"校园大使",value:"2"}),r(T,{label:"官方认证",value:"3"})])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),r(U,{fixed:"right",label:"操作",align:"center"},{default:c((e=>["1"==e.row.status&&"3"!=e.row.wxImgCheck?(d(),n("div",b,[r(I,{size:"small",type:"danger",onClick:t=>x.handleAuth(e.row.id,3,e.row.userId)},{default:c((()=>t[15]||(t[15]=[p("不通过")]))),_:2},1032,["onClick"]),r(I,{size:"small",type:"primary",onClick:t=>x.handleAuth(e.row.id,2,e.row.userId)},{default:c((()=>t[16]||(t[16]=[p("通过")]))),_:2},1032,["onClick"])])):m("",!0),"2"==e.row.status?(d(),n("div",y," 已通过认证 ")):m("",!0),"3"==e.row.status&&"3"!=e.row.wxImgCheck?(d(),n("div",k," 不通过："+w(e.row.cont),1)):m("",!0),"3"==e.row.status&&"3"==e.row.wxImgCheck?(d(),n("div",_,w(e.row.cont)+"，自动失败 ",1)):m("",!0)])),_:1})])),_:1},8,["data"])),[[L,z.loading]]),i("div",S,[r(R,{size:"small",onSizeChange:x.handleSizeChange,onCurrentChange:x.handleCurrentChange,"current-page":z.search.pageCount,"page-size":z.search.pageSize,"page-sizes":[10,20,30,50],background:"",layout:"total, sizes, prev, pager, next, jumper",total:z.total},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])])}],["__scopeId","data-v-5444aa25"]]);export{z as default};
